{"version":3,"sources":["controllers/user.js"],"names":["ctx","next","data","email_autofocus","loginWithData","login","request","body","options","url","resolve","api_address","json","response","postAsync","error","statusCode","cookie","setToken","token","setRole","user","role","redirect","message","errors","length","field","email_error","password_autofocus","password_error","loginRequest","registerWithData","register","password","confirm_password","confirm_password_error","confirm_password_autofocus","registerRequest","resetPasswordWithData","resetPassword","success","resetPasswordRequest","params","setPasswordWithData","setPassword","setPasswordRequest","theToken","getToken","bearerToken","headers","Authorization","clear","logoutRequest","debug","name","promisifyAll","html","join","__dirname"],"mappings":"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","file":"controllers/user.js","sourcesContent":["/**\n * Created by Bell on 16/8/16.\n */\n\nimport template from 'art-template';\nimport path from 'path';\nimport url from 'url';\nimport Request from 'request';\nimport bluebird from 'bluebird';\n\nimport config from '../config';\nimport * as token from '../utils/token';\nimport * as cookie from '../utils/cookie';\n\nimport Debug from 'debug';\nimport pkg from '../../package.json';\nconst debug = new Debug(pkg.name);\n\nconst request = bluebird.promisifyAll(Request);\n\nexport async function login(ctx, next) {\n    const data = {\n        email_autofocus: 'autofocus'\n    };\n    loginWithData(ctx, data);\n}\n\nexport async function loginRequest(ctx, next) {\n    let data = ctx.request.body;\n    const options = {\n        url: url.resolve(config.api_address, '/login'),\n        json: true,\n        body: data\n    };\n    let response = null;\n    try {\n        response = await request.postAsync(options);\n    } catch (err) {\n        data.error = 'Login failed';\n        loginWithData(ctx, data);\n        return;\n    }\n\n    const statusCode = response.statusCode;\n    const body = response.body;\n    if (statusCode == 200) {\n        cookie.setToken(ctx, body.token);\n        cookie.setRole(ctx, body.user.role);\n        ctx.redirect('/');\n    } else {\n        if (statusCode == 401) {\n            data.error = body.message;\n        } else if (statusCode == 422) {\n            if (body && body.errors && body.errors.length > 0) {\n                const error = body.errors[0];\n                if (error.field == 'email') {\n                    data.email_autofocus = 'autofocus';\n                    data.email_error = body.message;\n                } else if (error.field == 'password') {\n                    data.password_autofocus = 'autofocus';\n                    data.password_error = body.message;\n                } else {\n                    data.error = body.message;\n                }\n            } else {\n                data.error = body.message;\n            }\n        } else {\n            data.error = 'Login failed';\n        }\n        loginWithData(ctx, data);\n    }\n}\n\nexport async function register(ctx, next) {\n    const data = {\n        email_autofocus: 'autofocus'\n    };\n    registerWithData(ctx, data);\n}\n\nexport async function registerRequest(ctx, next) {\n    let data = ctx.request.body;\n    if (data.password && data.password != data.confirm_password) {\n        data.confirm_password_error = 'Please input same password';\n        data.confirm_password_autofocus = 'autofocus';\n        registerWithData(ctx, data);\n        return;\n    }\n\n    const options = {\n        url: url.resolve(config.api_address, '/register'),\n        json: true,\n        body: data\n    };\n\n    let response = null;\n    try {\n        response = await request.postAsync(options);\n    } catch (err) {\n        data.error = 'Register failed';\n        registerWithData(ctx, data);\n        return;\n    }\n    const body = response.body;\n    if (response.statusCode == 200) {\n        cookie.setToken(ctx, response.body.token);\n        cookie.setRole(ctx, body.user.role);\n        ctx.redirect('/');\n    } else {\n        if (response.statusCode == 422) {\n            if (body && body.errors && body.errors.length > 0) {\n                const error = body.errors[0];\n                if (error.field == 'email') {\n                    data.email_autofocus = 'autofocus';\n                    data.email_error = body.message;\n                } else if (error.field == 'password') {\n                    data.password_autofocus = 'autofocus';\n                    data.password_error = body.message;\n                } else {\n                    data.error = body.message;\n                }\n            } else {\n                data.error = body.message;\n            }\n        } else {\n            data.error = 'Register failed';\n        }\n        registerWithData(ctx, data);\n    }\n}\n\nexport async function resetPassword(ctx, next) {\n    const data = {\n        email_autofocus: 'autofocus'\n    };\n    resetPasswordWithData(ctx, data);\n}\n\nexport async function resetPasswordRequest(ctx, next) {\n    let data = ctx.request.body;\n    const options = {\n        url: url.resolve(config.api_address, '/reset-password'),\n        json: true,\n        body: data\n    };\n\n    let response = null;\n    try {\n        response = await request.postAsync(options);\n    } catch (err) {\n        data.error = 'Reset password failed';\n        resetPasswordWithData(ctx, data);\n        return;\n    }\n    const body = response.body;\n    if (response.statusCode == 200) {\n        data.success = body.message;\n        resetPasswordWithData(ctx, data);\n    } else {\n        if (response.statusCode == 422) {\n            if (body && body.errors && body.errors.length > 0) {\n                const error = body.errors[0];\n                if (error.field == 'email') {\n                    data.email_autofocus = 'autofocus';\n                    data.email_error = body.message;\n                } else {\n                    data.error = body.message;\n                }\n            } else {\n                data.error = body.message;\n            }\n        } else {\n            data.error = 'Reset password failed';\n        }\n        registerWithData(ctx, data);\n    }\n}\n\nexport async function setPassword(ctx, next) {\n    const data = {\n        token: ctx.params.token,\n        password_autofocus: 'autofocus'\n    };\n    setPasswordWithData(ctx, data);\n}\n\nexport async function setPasswordRequest(ctx, next) {\n    let data = ctx.request.body;\n    if (data.password && data.password != data.confirm_password) {\n        data.confirm_password_error = 'Please input same password';\n        data.confirm_password_autofocus = 'autofocus';\n        setPasswordWithData(ctx, data);\n        return;\n    }\n\n    data.token = ctx.params.token;\n    const options = {\n        url: url.resolve(config.api_address, '/set-password/'),\n        json: true,\n        body: data\n    };\n\n    let response = null;\n    try {\n        response = await request.postAsync(options);\n    } catch (err) {\n        data.error = 'Set password failed';\n        setPasswordWithData(ctx, data);\n        return;\n    }\n    const body = response.body;\n    if (response.statusCode == 200) {\n        ctx.redirect('/login');\n    } else {\n        if (response.statusCode == 422) {\n            if (body && body.errors && body.errors.length > 0) {\n                const error = body.errors[0];\n                if (error.field == 'password') {\n                    data.password_autofocus = 'autofocus';\n                    data.password_error = body.message;\n                } else if (error.field == 'confirm_password') {\n                    data.confirm_password_autofocus = 'autofocus';\n                    data.confirm_password_error = body.message;\n                } else {\n                    data.error = body.message;\n                }\n            } else {\n                data.error = body.message;\n            }\n        } else {\n            data.error = 'Set password failed';\n        }\n        setPasswordWithData(ctx, data);\n    }\n}\n\nexport async function logoutRequest(ctx, next) {\n    const theToken = cookie.getToken(ctx);\n    if (theToken && theToken.length > 0) {\n        const bearerToken = token.bearerToken(theToken);\n        const options = {\n            url: url.resolve(config.api_address, '/logout'),\n            headers: {\n                Authorization: bearerToken\n            }\n        };\n        const response = await request.postAsync(options);\n        cookie.clear(ctx);\n    }\n    ctx.redirect('/');\n}\n\nfunction loginWithData(ctx, data) {\n    var html = template(path.join(__dirname, '../views/user/login'), data);\n    ctx.body = html;\n}\n\nfunction registerWithData(ctx, data) {\n    var html = template(path.join(__dirname, '../views/user/register'), data);\n    ctx.body = html;\n}\n\nfunction resetPasswordWithData(ctx, data) {\n    var html = template(path.join(__dirname, '../views/user/reset-password'), data);\n    ctx.body = html;\n}\n\nfunction setPasswordWithData(ctx, data) {\n    var html = template(path.join(__dirname, '../views/user/set-password'), data);\n    ctx.body = html;\n}\n"],"sourceRoot":"/source/"}